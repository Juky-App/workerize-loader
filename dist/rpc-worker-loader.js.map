{"version":3,"file":"rpc-worker-loader.js","sources":["../src/rpc-worker-loader.js"],"sourcesContent":["/* global __webpack_exports__ */\n\nfunction workerSetup() {\n\taddEventListener('message', (e) => {\n\t\tlet { type, method, id, params } = e.data, f, p;\n\t\tif (type==='RPC' && method) {\n\t\t\tif ((f = __webpack_exports__[method])) {\n\t\t\t\tp = Promise.resolve().then( () => f.apply(__webpack_exports__, params) );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tp = Promise.reject('No such method');\n\t\t\t}\n\t\t\tp.then(result => {\n\t\t\t\tpostMessage({ type: 'RPC', id, result });\n\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tlet message;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmessage = e.message.toString();\n\t\t\t\t\t}\n\t\t\t\t\tcatch (ex) {\n\t\t\t\t\t\tmessage = null;\n\t\t\t\t\t}\n\t\t\t\t\tlet error = { message };\n\t\t\t\t\tif (e.stack) {\n\t\t\t\t\t\terror.stack = e.stack;\n\t\t\t\t\t\terror.name = e.name;\n\t\t\t\t\t}\n\t\t\t\t\tif (e.status) {\n\t\t\t\t\t\terror.status = e.status;\n\t\t\t\t\t\terror.responseJson = e.responseJson;\n\t\t\t\t\t}\n\t\t\t\t\tpostMessage({ type: 'RPC', id, error });\n\t\t\t\t});\n\t\t}\n\t});\n\tpostMessage({ type: 'RPC', method: 'ready' });\n}\n\nconst workerScript = '\\n' + Function.prototype.toString.call(workerSetup).replace(/(^.*\\{|\\}.*$|\\n\\s*)/g, '');\n\nexport default function rpcWorkerLoader(content, sourceMap) {\n\tconst callback = this.async();\n\tcallback(null, content + workerScript, sourceMap);\n}\n"],"names":["workerSetup","addEventListener","e","data","type","method","id","params","f","p","__webpack_exports__","Promise","resolve","then","apply","reject","result","postMessage","catch","message","toString","ex","error","stack","name","status","responseJson","workerScript","Function","prototype","call","replace","rpcWorkerLoader","content","sourceMap","callback","async"],"mappings":"AAAA;AAEA,SAASA,WAAT,GAAuB;AACtBC,EAAAA,gBAAgB,CAAC,SAAD,EAAY,UAACC,CAAD,EAAO;AAAA,kBACCA,CAAC,CAACC,IADH;AAAA,QAC5BC,IAD4B,WAC5BA,IAD4B;AAAA,QACtBC,MADsB,WACtBA,MADsB;AAAA,QACdC,EADc,WACdA,EADc;AAAA,QACVC,MADU,WACVA,MADU;AAAA,QACSC,CADT;AAAA,QACYC,CADZ;;AAElC,QAAIL,IAAI,KAAG,KAAP,IAAgBC,MAApB,EAA4B;AAC3B,UAAKG,CAAC,GAAGE,mBAAmB,CAACL,MAAD,CAA5B,EAAuC;AACtCI,QAAAA,CAAC,GAAGE,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAwB;AAAA,iBAAML,CAAC,CAACM,KAAF,CAAQJ,mBAAR,EAA6BH,MAA7B,CAAN;AAAA,SAAxB,CAAJ;AACA,OAFD,MAGK;AACJE,QAAAA,CAAC,GAAGE,OAAO,CAACI,MAAR,CAAe,gBAAf,CAAJ;AACA;;AACDN,MAAAA,CAAC,CAACI,IAAF,CAAO,UAAAG,MAAM,EAAI;AAChBC,QAAAA,WAAW,CAAC;AAAEb,UAAAA,IAAI,EAAE,KAAR;AAAeE,UAAAA,EAAE,EAAFA,EAAf;AAAmBU,UAAAA,MAAM,EAANA;AAAnB,SAAD,CAAX;AACA,OAFD,EAGEE,KAHF,CAGQ,UAAAhB,CAAC,EAAI;AACX,YAAIiB,OAAJ;;AACA,YAAI;AACHA,UAAAA,OAAO,GAAGjB,CAAC,CAACiB,OAAF,CAAUC,QAAV,EAAV;AACA,SAFD,CAGA,OAAOC,EAAP,EAAW;AACVF,UAAAA,OAAO,GAAG,IAAV;AACA;;AACD,YAAIG,KAAK,GAAG;AAAEH,UAAAA,OAAO,EAAPA;AAAF,SAAZ;;AACA,YAAIjB,CAAC,CAACqB,KAAN,EAAa;AACZD,UAAAA,KAAK,CAACC,KAAN,GAAcrB,CAAC,CAACqB,KAAhB;AACAD,UAAAA,KAAK,CAACE,IAAN,GAAatB,CAAC,CAACsB,IAAf;AACA;;AACD,YAAItB,CAAC,CAACuB,MAAN,EAAc;AACbH,UAAAA,KAAK,CAACG,MAAN,GAAevB,CAAC,CAACuB,MAAjB;AACAH,UAAAA,KAAK,CAACI,YAAN,GAAqBxB,CAAC,CAACwB,YAAvB;AACA;;AACDT,QAAAA,WAAW,CAAC;AAAEb,UAAAA,IAAI,EAAE,KAAR;AAAeE,UAAAA,EAAE,EAAFA,EAAf;AAAmBgB,UAAAA,KAAK,EAALA;AAAnB,SAAD,CAAX;AACA,OArBF;AAsBA;AACD,GAhCe,CAAhB;AAiCAL,EAAAA,WAAW,CAAC;AAAEb,IAAAA,IAAI,EAAE,KAAR;AAAeC,IAAAA,MAAM,EAAE;AAAvB,GAAD,CAAX;AACA;;AAED,IAAMsB,YAAY,GAAG,OAAOC,QAAQ,CAACC,SAAT,CAAmBT,QAAnB,CAA4BU,IAA5B,CAAiC9B,WAAjC,EAA8C+B,OAA9C,CAAsD,sBAAtD,EAA8E,EAA9E,CAA5B;AAEe,SAASC,eAAT,CAAyBC,OAAzB,EAAkCC,SAAlC,EAA6C;AAC3D,MAAMC,QAAQ,GAAG,KAAKC,KAAL,EAAjB;AACAD,EAAAA,QAAQ,CAAC,IAAD,EAAOF,OAAO,GAAGN,YAAjB,EAA+BO,SAA/B,CAAR;AACA;;;;"}